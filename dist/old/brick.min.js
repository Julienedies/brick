/*! brick 2014-10-11 13:49:14 by @Julien */
!function(a,b){function c(){function a(a){if(a&&a.constructor===Object)for(var b in a)this[b]=a[b];this._pool={}}var c={k:"id",init:function(a){if("object"!=typeof a)throw"must be Array or Object on init";this._pool;for(var b in a){var c=a[b];this.beforeSave(c,b)}return this._pool=a,this.fire("init"),this},get:function(a,b){var c=this._pool,d=[];if(!arguments.length){for(var e in c)d.push($.extend(!0,{},c[e]));return d}for(var f in c){var g=c[f];a===this._queryKeyValue(g,b)&&d.push($.extend(!0,{},g))}return d},set:function(a,b){var c=this._pool,d=this._find||[],e=[];for(var f in d){var g=d[f];if(!b||this._queryKeyValue(g,b)!==this._queryKeyValue(a,b)){var h=this._queryKeyValue(g),i=this._getIndex(h);g=c[i],e.push($.extend(!0,g,a)),this.beforeSave(g),this.fire("change."+h,{change:g})}}return this.end(),e.length?e:!1},add:function(a){var b=this._pool,c=this._queryKeyValue(a);return this.beforeSave(a),b.push?b.push(a):b[c]=a,this.fire("add",{add:a}),this},remove:function(){var a=this._pool,c=this._find||[];for(var d in c){var e=c[d],f=this._queryKeyValue(e),g=this._getIndex(f);a.splice&&g!==b?a.splice(g,1):delete a[f],this.fire("remove."+f,{remove:e})}return this.end(),c},clear:function(){return this._pool={},this.end(),this.fire("clear"),this},find:function(a,b){return this._find=this.get(a,b),this},result:function(){return this._find},end:function(){this._find=void 0},fire:function(a,b){var c=this.scope,d=this.get(),e=this.eventPrefix?this.eventPrefix+".":"";b=$.extend({pool:d},b||{}),c&&c.fire&&c.fire(e+a,b)},beforeSave:function(){},_queryKeyValue:function(a,b){return this._get(a,b).v},_get:function(a,b){var c=(b||this.k).split("."),d=function(a,b){var c=a.shift(),d=b[c];return a.length?arguments.callee(a,d):d}(c,a);return{r:a,v:d}},_getIndex:function(a,b){var c=this._pool,d="object"==typeof a?this._queryKeyValue(a,b):a;for(var e in c)if(this._queryKeyValue(c[e],b)===d)return e},_look:function(){console.log(this._pool)}};for(var d in c)a.prototype[d]=c[d];return a}function d(a){if(1!=a.nodeType){if(3==a.nodeType){var b=a.nodeValue;a.nodeValue=b.replace(/{{(.+?)}}/g,"<%= $1 %>")}}else{for(var c,d,e,f=$(a),g=a.attributes,h=[],i={skip:-100,init:-10,"for":0,"for-init":10,"if":100,"if-init":110,"else":100,bind:1e3},j=0,k=g.length;k>j;j++)if(c=g[j],d=c.name,e=c.value,/^ic-(init|for|if|else|bind|skip)/.test(d))h.push([d,e]);else try{}catch(l){_cc(l)}for(h.sort(function(a,b){return i[a[0].replace(/^ic-/,"")]-i[b[0].replace(/^ic-/,"")]});c=h.shift();){if(d=c[0],e=c[1],/-skip$/.test(d))return void f.remove();/-init$/.test(d)?f.before("\r\n<% "+e+" %>\r\n"):/-for$/.test(d)?(f.before("<% for("+e+"){ %>\r\n"),f.after("\r\n<% } %>")):/-if$/.test(d)?(f.before("<% if("+e+"){ %>\r\n"),f.after("\r\n<% } %>")):/-else$/.test(d)?(f.before("<% else{ %>\r\n"),f.after("\r\n<% } %>")):/-bind$/.test(d)&&f.html("\r\n<%= "+e+" %>\r\n")}}}function e(a){!function(a){d(a);for(var b,c=$(a).contents(),e=0;b=c.eq(e)[0];)e++,arguments.callee(b)}(a);var b=$(a).html().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/\b(ic-)(?=href|src|style)/g,"");return window.console&&console.log(b),_.template(b)}var f=function(){var a={directive_prefix:"ic"};return{get:function(b){return a[b]},set:function(b,c){a[b]=c}}}(),g=function(){var a={};return{bind:function(a,b,c){var d={f:b},e=this._getNamespace(a);c&&(d.context=c);var f=e._callback=e._callback||[];f.push(d)},unbind:function(a,b){var c,d=this._getNamespace(a),e=d&&d._callback;if(e){if(!b)return void delete d._callback;for(var f=0,g=e.length;g>f;f++)if(c=e[f],b===c.f||b.toString()===c.f.toString())return void e.splice(f,1)}},fire:function(a,b,c){var d=a.split(/\.|\:/),e=d.shift(),f=[a];!function(a,b){if(a.length){b=b?b+".":"";for(var c=0,d=a.length;d>c;c++){var e=a.slice();e.splice(0,c+1);var g=b+"*"+(e.length?"."+e.join("."):"");f.push(g)}b+=a.shift(),arguments.callee(a,b)}}(d.slice(),e);for(var g;g=f.shift();)this._fire(g,b,c)},_fire:function(a,b,c){var d,e,f,g=this._getNamespace(a),h=g&&g._callback;if(h)for(var i=0,j=h.length;j>i;i++)d=h[i],e=d.context||{},f=d.f,f.constructor===Function&&f.apply(e,[{eventName:a,source:c},b])},_getNamespace:function(b){return a[b]=a[b]||{}}}}(),h=function(){function a(a,b){for(var c in b)a[c]=b[c];return a}function b(){}function c(c,d){function e(){this._name=c}return e.prototype=new b,a(e.prototype,d||{}),new e}var d={},e={};return a(b.prototype,{set:function(a,b){this[a]=b,this.render()},get:function(a){return this[a]},_bind:function(a){"string"==typeof a&&(a=[a]);for(var b,c=0,d=a.length;d>c;c++)b=e[a[c]]=e[a[c]]||[],b.push(this._name)},_cancel:function(a){if(!a)return void delete e[this._name];"string"==typeof a&&(a=[a]);var b=e[this._name];if(b&&b.shift)for(var c;c=a.shift();)for(var d=0,f=b.length;f>d;d++)b[d]===c&&b.splice(d,1)},_fire:function(b){for(var c,f=this._name,g=(e[f]||[]).slice();c=g.shift();)d[c].scope._watch(a({source:this},b||{}))},_watch:function(){},fire:function(a,b){var c=this;g.fire(a,b,c)},watch:function(a,b){var c=this;g.bind(a,b,c)},unbind:function(a,b){g.unbind(a,b)},tmplFn:function(){},diff:function(){},htmlList:null,updateDom:function(){},render:function(){var a=this.tmplFn({data:this});if(this.htmlList){var b=this.diff(a);if(!b)return;return this.htmlList=a,this.updateDom(b)}this.domNode&&this.domNode.html(a)}}),{bind:e,get:function(a){return d[a]&&d[a].scope},add:function(a,b,e){e=e||{};var f,g=e.parent,h=e.depend||[];f=g?c(a,d[g]):c(a),e.global&&(window[a]=f),d[a]={fn:b,scope:f,depend:h,service:e.service}},init:function(){var a,b,c,e=d;for(var f in e)a=e[f],b=i.get(a.depend)||[],b.constructor!==Array&&(b=[b]),b.unshift(a.scope),c=a.fn.apply(null,b),a.service&&i.fill(f,c)}}}(),i=function(){var a={},b={};return{_look:function(){console.log(b)},add:function(a,c,d){b[a]={depend:d,serve:c}},create:function(a){var c=this,d=b[a];if(d){var e=d.depend;return e&&(e=c.get(e)),d.serve.apply(null,e||[])}},fill:function(b,c){a[b]=c},get:function(b){var c=this;if(b){if("string"==typeof b)return a[b]=a[b]||c.create(b);if(b.constructor===Array){b=b.slice();for(var d,e=0,f=b.length;f>e;e++)d=b[e],b[e]=a[d]=a[d]||c.create(d);return b}}}}}(),j=function(){return{add:function(){}}}();i.add("recordManager",c),a.brick={config:f,eventManager:g,controllers:h,services:i,directives:j,init:function(){this.controllers.init(),$("[ic-ctrl]").each(function(a,b){var c=$(b),d=c.attr("ic-ctrl"),f=brick.controllers.get(d);if(!f)throw"not find controller "+d;f.domNode=c,f.tmplFn=e(b),f.render()})}},a._cc=window.console&&function(){try{console.log.apply(console,arguments)}catch(a){}}||function(){}}(window);