{"version":3,"file":"brick.datepicker.js","sources":["webpack://[name]/webpack/universalModuleDefinition","webpack://[name]/webpack/bootstrap","webpack://[name]/./directives/datepicker.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"brick.datepicker\"] = factory();\n\telse\n\t\troot[\"brick.datepicker\"] = factory();\n})(this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./directives/datepicker.js\");\n","/**\n * require moment.js (https://github.com/moment/moment/)\n * Created by julien on 2015/8/26.\n */\n\n/**\n * note: ic-tpl 和 其它指令绑定在相同元素上, 小心避免陷入编译死循环!\n * config:\n * ic-date-now     #定义当前日期，通常有server端提供，如果未提供则为浏览器端当前日期\n * ic-date-default=\"2015-08-31\" #默认选中日期，多个以,或空格分隔\n * ic-date-format   #定义日期格式化格式,默认为YYYY-MM-DD，格式定义详见moment库\n * ic-date-multiple=\"true\" #是否多选\n * ic-date-week-start #定义周一到周日的排列顺序，1-7 分别对应周一到周日\n * ic-date-on-render  #自定义render函数，接受一个日期模型对象作为参数，改日期对象封装了相关的日期数据，开发者根据需要渲染成合适的html\n *\n * ic-date-prev-m  #定义一个dom元素为显示上月按钮，如果有disabled属性，则无效\n * ic-date-next-m  #定义一个dom元素为显示下月按钮，如果有disabled属性，则无效\n * ic-date         #定义一个dom元素为日期选择cell，通过ic-date-enabled属性使其可用\n *\n * attach:\n * ic-date 2012-08-27,格式由 ic-date-format 定义\n * ic-date-status over:过去  today:今天  coming:未来\n *\n\n */\nbrick.directives.reg('ic-date-picker', function ($elm) {\n\n    //var tpl = brick.createRender($elm[0]);\n\n    var _d = new Date();\n    var tpl = $elm.attr('ic-tpl-name');\n    var _date = $elm.attr('ic-date-now') || _d.getFullYear() + '-' + (_d.getMonth() + 1) + '-' + _d.getDate();\n    var _format = $elm.attr('ic-date-format') || 'YYYY-MM-DD';\n    var multiple = $elm.attr('ic-date-multiple');\n    var weekStart = $elm.attr('ic-date-week-start') || 1;\n    var enabled = $elm.attr('ic-date-enabled') ? '[ic-date-enabled]' : '';\n    var disabled = $elm.attr('ic-date-disabled') ? ':not([ic-date-disabled])' : '';\n    var onRender = $elm.icParseProperty2('ic-date-on-render');\n\n    var START = _date;\n    var now = moment(_date, _format);\n    var cla = 'selected';\n    var weekMap = (function (weekStart) {\n        var week = _.range(1, 8);\n        var index = _.indexOf(week, weekStart * 1);\n        var split = week.splice(index);\n        split.unshift(0, 0);\n        week.splice.apply(week, split);\n        return week;\n    })(weekStart);\n\n    var selectedDateArr = (function () {\n        var d = $elm.attr('ic-date-default');\n        d = d && d.trim() && d.split(/(?:\\s*,\\s*)|(?:\\s+)/img);\n        return d || [];\n    })();\n\n    //更新html\n    function render(date, flag) {\n        var dateModel = model(date);\n        if (onRender && !flag) {\n            onRender(dateModel);\n        } else {\n            $elm.icRender(tpl, {vm: dateModel});\n            $elm.trigger('ic-date-picker.init');\n        }\n    }\n\n    render(undefined, true);\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////\n    //对外js接口\n    $elm.on('ic-date-picker.render', function (e, msg) {\n        try {\n            $elm.icRender(tpl, msg);\n            $elm.trigger('ic-date-picker.init');\n        } catch (e) {\n            console.log(e);\n        }\n    });\n\n    $elm.on('ic-date-picker.recover', function (e, msg) {\n        _date = old_date;\n    });\n\n    $elm.on('ic-date-picker.next', function (e, msg) {\n        old_date = _date;\n        _date = moment(_date, _format).add(1, 'months').format(_format);\n        render(_date);\n    });\n\n    //取消一个日期选择, msg == YYYY-MM-DD\n    $elm.on('ic-date-picker.cancel', function (e, msg) {\n        $elm.find('[ic-date=?]'.replace('?', msg)).removeClass(cla);\n        selectedDateArr = _.without(selectedDateArr, msg);\n    });\n\n    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////\n    var old_date;\n\n    var eventAction = brick.get('event.action') || 'click';\n\n    $elm.on(eventAction, '[ic-date-prev-m]:not([disabled]), [ic-date-next-m]:not([disabled])', function (e) {\n        var call = this.hasAttribute('ic-date-prev-m') ? 'subtract' : 'add';\n        old_date = _date;\n        _date = moment(_date, _format)[call](1, 'months').format(_format);\n        console.info(_date);\n        render(_date);\n    });\n\n    $elm.on(eventAction, '[ic-date]' + enabled, multiple ? function (e) {\n        var bindDate = this.getAttribute('ic-date');\n        if (this.classList.contains(cla)) {\n            this.classList.remove(cla);\n            selectedDateArr = _.without(selectedDateArr, bindDate);\n        } else {\n            this.classList.add(cla);\n            selectedDateArr.push(bindDate);\n        }\n        $elm.trigger('ic-date-picker.change', [selectedDateArr]);\n\n    } : function (e) {\n        if (!this.classList.contains(cla)) {\n            $elm.find('[ic-date]').removeClass(cla);\n            selectedDateArr = [];\n            selectedDateArr.push(this.getAttribute('ic-date'));\n            this.classList.add(cla);\n            $elm.trigger('ic-date-picker.change', [selectedDateArr]);\n        }\n    });\n\n    //////////////////////////////////////////////////////\n    //init\n    render(_date);\n\n    /////////////////////////////////////////////////////\n\n    //计算一个月的天数\n    function _countDays(current) {\n        var year = current.year();\n        var month = current.month();\n        var days = _.range(1, current.daysInMonth() + 1);\n        return days.map(function (day) {\n            return moment([year, month, day]).format(_format);\n        });\n    }\n\n    //时间数据模型\n    function model(date) {\n\n        var current = date ? moment(date, _format) : moment();\n        var prev = date ? moment(date, _format) : moment();\n        prev.subtract(1, 'months');\n        var next = date ? moment(date, _format) : moment();\n        next.add(1, 'months');\n\n        console.log(next.format(_format));\n\n        var year = current.year();\n        var month = current.month();\n\n        //var days = _.range(1, current.daysInMonth() + 1);\n        var calendar = [];\n        var days = _countDays(current);\n        var prevDays = _countDays(prev);\n        var nextDays = _countDays(next);\n\n        var len = days.length;\n\n        var w = moment([year, month, 1]).weekday();\n        if (w === 0) w = 7;\n\n        var start = _.indexOf(weekMap, w);\n        var _start = start;\n        console.log(weekMap, w, start);\n        while (_start > 0) {\n            days.unshift(prevDays.pop());\n            _start--;\n        }\n\n        var end = Math.ceil(days.length / 7) * 7 - days.length;\n        //var end = 42 - days.length;\n        while (end > 0) {\n            days.push(nextDays.shift());\n            end--;\n        }\n\n        days = days.map(function (v, i) {\n            var m = moment(v, _format);\n            var diff = m.diff(now, 'days');\n            var status = diff < 0 ? 'over' : diff > 0 ? 'coming' : 'today';\n            var position = i < start ? 'prev' : i > (len + start - 1) ? 'next' : 'current';\n            var isSelected = _.indexOf(selectedDateArr, v) > -1;\n            var n = v.replace(/^\\d\\d\\d\\d-\\d\\d-0?/i, '');\n            var day = {n: n, date: v, status: status, diff: diff, selected: isSelected, position: position, custom: {}};\n            calendar.push(day);\n            return day;\n        });\n\n        var weeks = [];\n        var week = days.splice(0, 7);\n        while (week.length) {\n            weeks.push(week);\n            week = days.splice(0, 7);\n        }\n\n        return {\n            current: current.format('YYYY-MM'),\n            weeks: weeks,\n            calendar: calendar,\n            year: current.format('YYYY'),\n            month: current.format('MM'),\n            x: current.diff(now, 'months')\n        };\n    }\n\n});"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClFA;;;;;AAKA;;;;;;;;;;;;;;;;;;;;AAoBA;AAEA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;AAIA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AAEA;;;;;A","sourceRoot":""}